### Часть 1: Создание сети и настройка основных параметров устройства

В части 1 мы настроим топологию сети и основные параметры маршрутизаторов.

#### Шаг 1: Подключение сети, как показано в топологии.

![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/photo_2023-09-16_10-55-54.jpg)

##### Шаг 2:	Выполните инициализацию и перезагрузку коммутаторов.

##### Шаг 3:	Настройте базовые параметры каждого коммутатора.

a.	Отключим поиск DNS.
```
 Switch>en  
 Switch#conf t  
 Enter configuration commands, one per line.  End with CNTL/Z.  
 Switch(config)#no ip domain-lookup    
```
b.	Присвоим имена устройствам в соответствии с топологией.
```
Switch(config)#hostname S1  
```

c.	Назначим class в качестве зашифрованного пароля доступа к привилегированному режиму.
```
S1(config)#enable secret class  
```

d.	Назначем cisco в качестве паролей консоли и VTY и активируйте вход для консоли и VTY каналов.
```
S1(config)#line con 0  
S1(config-line)#password cisco  
S1(config-line)#login  
S1(config-line)#logging synchronous   
```

```
S1(config-line)#line vty 0 4  
S1(config-line)#password cisco    
S1(config-line)#login  
S1(config-line)#logging synchronous   
```

e.	Настроим баннерное сообщение дня (MOTD) для предупреждения пользователей о запрете несанкционированного доступа.
```
S1(config)#Banner motd "This is a secure system. Authorized Access Only!"  
```

f.	Зададим IP-адрес, указанный в таблице адресации для VLAN 1 на всех коммутаторах.
```
S1(config)#int vlan 1  
S1(config-if)#ip address 192.168.1.1 255.255.255.0
S1(config-if)#no shutdown  
```

g.	Скопируйте текущую конфигурацию в файл загрузочной конфигурации.
```
S1#wr  
Building configuration...  
Compressed configuration from 3244 bytes to 1619 bytes[OK]  
S1#  
```

#### Шаг 4:	Проверим связь.

Проверим способность компьютеров обмениваться эхо-запросами.  

Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S2?	  
![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/ping%20s1%20to%20s2.png)

Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S3?	  
![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/ping%20s1%20to%20s3.png)

Успешно ли выполняется эхо-запрос от коммутатора S2 на коммутатор S3?	  
![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/ping%20s2%20to%20s3.png)


### Часть 2:	Определение корневого моста

Для каждого экземпляра протокола spanning-tree (коммутируемая сеть LAN или широковещательный домен) существует коммутатор, выделенный в качестве корневого моста. Корневой мост служит точкой привязки для всех расчётов протокола spanning-tree, позволяя определить избыточные пути, которые следует заблокировать.
Процесс выбора определяет, какой из коммутаторов станет корневым мостом. Коммутатор с наименьшим значением идентификатора моста (BID) становится корневым мостом. Идентификатор BID состоит из значения приоритета моста, расширенного идентификатора системы и MAC-адреса коммутатора. Значение приоритета может находиться в диапазоне от 0 до 65535 с шагом 4096. По умолчанию используется значение 32768.

#### Шаг 1:	Отключим все порты на коммутаторах.
```
S1(config)#int range gi0/0-1, gi1/0-1  
S1(config-if-range)#shutdown
```

```
S2(config)#int range gi0/0-3  
S2(config-if-range)#shutdown
```

```
S3(config)#int range gi0/2-3, gi1/0-1  
S3(config-if-range)#shutdown   
```

#### Шаг 2:	Настроим подключенные порты в качестве транковых.
```
S1(config-if-range)#switchport trunk encapsulation dot1q   
S1(config-if-range)#switchport mode trunk   
```

#### Шаг 3:	Включим по одному линку на всех коммутаторах.
```
S1(config)#int range gi0/0, gi1/0  
S1(config-if-range)#no shutdown  
```

```
S2(config)#int range gi0/0, gi0/2                 
S2(config-if-range)#no shutdown  
```

```
S3(config)#int range gi0/2, gi1/0  
S3(config-if-range)#no shutdown  
```

#### Шаг 4:	Отобразим данные протокола spanning-tree.
Введем команду show spanning-tree на всех трех коммутаторах. 

![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/show%20sp%20s1.png)

![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/show%20sp%20s2.png)

![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/show%20sp%20s3.png)

Ниже запишем роль и состояние (Sts) активных портов на каждом коммутаторе в топологии.

S1: 
Gi0/0 Desg FWD  
Gi1/0 Desg FWD  

S2:
Gi0/0 Root FWD  
Gi0/2 Desg FWD  

S3:
Gi1/0 Root FWD  
Gi0/2 Altn BLK  

С учетом выходных данных, поступающих с коммутаторов, ответим на следующие вопросы.  
Какой коммутатор является корневым мостом?  
> Корневым мостом является S1

Почему этот коммутатор был выбран протоколом spanning-tree в качестве корневого моста?
> Так как на всех коммутаторах одинаковый Priority, протокол spanning-tree сравнил значение mac адреса, и у S1 он наименьший.  

Какие порты на коммутаторе являются корневыми портами?  
> Это порты, которые смотрят в сторону корнего моста.
> S2: Gi0/0
> S3: Gi1/0  

Какие порты на коммутаторе являются назначенными портами?
> Не корневые порты, принимающие трафик
> S1: Gi0/0 и Gi1/0
> S2: Gi0/2

Какой порт отображается в качестве альтернативного и в настоящее время заблокирован?  
> S3: Gi0/2

Почему протокол spanning-tree выбрал этот порт в качестве невыделенного (заблокированного) порта?
> Так как при одинаковом значении cost, порт Gi0/2 на коммутаторе S2 имеет меньшее значение mac адреса.

### Часть 3:	Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов

#### Шаг 1:	Определим коммутатор с заблокированным портом.

Ранее выяснили, что это S3.
![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/show%20sp%20s3.png)  

#### Шаг 2:	Изменим стоимость порта.
Помимо заблокированного порта, единственным активным портом на этом коммутаторе является порт, выделенный в качестве порта корневого моста. Уменьшите стоимость этого порта корневого моста до 18, выполнив команду spanning-tree cost 3 режима конфигурации интерфейса.
```
S3(config)# interface gi1/0  
S3(config-if)# spanning-tree cost 3  
```

#### Шаг 3:	Просмотрим изменения протокола spanning-tree.
Повторно выполните команду show spanning-tree на обоих коммутаторах некорневого моста.   
S2  
![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/show%20sp%20s2_new.png)    

S3  
![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/show%20sp%20s3_new.png)    

Почему протокол spanning-tree заменяет ранее заблокированный порт на назначенный порт и блокирует порт, который был назначенным портом на другом коммутаторе?
> Назначенный порт имеет наилучший путь для приема трафика, ведущего к корневому мосту. Значение cost на порту со стороны S3 уменьшилось, а значит он стал предпочнительнее, и их роль поменялась.

#### Шаг 4:	Удалите изменения стоимости порта.  

a.	Выполните команду no spanning-tree cost 3 режима конфигурации интерфейса, чтобы удалить запись стоимости, созданную ранее.
```
S3(config)# interface gi1/0  
S3(config-if)# no spanning-tree cost 3
```

b.	Повторно выполните команду show spanning-tree, чтобы подтвердить, что протокол STP сбросил порт на коммутаторе некорневого моста, вернув исходные настройки порта. Протоколу STP требуется примерно 30 секунд, чтобы завершить процесс перевода порта.

![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/show%20sp%20s2.png)

![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/show%20sp%20s3.png)  

### Часть 4:	Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов  

Если стоимости портов равны, процесс сравнивает BID. Если BID равны, для определения корневого моста используются приоритеты портов. Значение приоритета по умолчанию — 128. STP объединяет приоритет порта с номером порта, чтобы разорвать связи. Наиболее низкие значения являются предпочтительными. В части 4 нам предстоит активировать избыточные пути до каждого из коммутаторов, чтобы просмотреть, каким образом протокол STP выбирает порт с учетом приоритета портов.

a.	Включите все порты на всех коммутаторах.
```
S1(config)# int range Gi0/1, Gi1/1  
S1(config-if-range)#no shutdown
```

```
S2(config)#int range Gi0/1, Gi0/3   
S2(config-if-range)#no shutdown   
```

```
S3(config)#int range Gi0/3, Gi1/1  
S3(config-if-range)#no shutdown
```

b.	Подождите 30 секунд, чтобы протокол STP завершил процесс перевода порта, после чего выполните команду show spanning-tree на коммутаторах некорневого моста. Обратите внимание, что порт корневого моста переместился на порт с меньшим номером, связанный с коммутатором корневого моста, и заблокировал предыдущий порт корневого моста.

![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/show%20sp%20s2_new2.png)

![Alt text](https://github.com/bislogin/otus/blob/main/labs/lab01/ipv4/show%20sp%20s3_new2.png)

Какой порт выбран протоколом STP в качестве порта корневого моста на каждом коммутаторе некорневого моста?  
> S2: Gi0/0 Root    
> S3: Gi1/0 Root


Почему протокол STP выбрал эти порты в качестве портов корневого моста на этих коммутаторах?
> Эти порты ближайшие к корневому мосту с точки зрения общей стоимости маршрута к нему.   
